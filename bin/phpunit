#!/usr/bin/env sh

set -e

readonly PROJECT_DIRECTORY=$(dirname $(realpath $0))/..

if [[ "$(which phpdbg)" != "" ]]; then
    # code coverage with phpdbg
    /usr/bin/env phpdbg -qrr ${PROJECT_DIRECTORY}/vendor/bin/phpunit ${PROJECT_DIRECTORY}/tests \
        --colors=always \
        --process-isolation \
        --bootstrap ${PROJECT_DIRECTORY}/vendor/autoload.php \
        --log-junit ${PROJECT_DIRECTORY}/build/phpunit/junit.xml \
        --whitelist=${PROJECT_DIRECTORY}/src \
        --coverage-html ${PROJECT_DIRECTORY}/build/coverage-report \
        --coverage-clover ${PROJECT_DIRECTORY}/build/coverage-report/clover.xml
else
    # no code coverage
    ${PROJECT_DIRECTORY}/vendor/bin/phpunit ${PROJECT_DIRECTORY}/tests \
        --colors=always \
        --process-isolation \
        --bootstrap ${PROJECT_DIRECTORY}/vendor/autoload.php
fi
